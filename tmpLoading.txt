import React, { useEffect, useRef } from "react";
import { gsap } from "gsap";
import { Landmark } from "lucide-react";

const LoadingScreen = () => {
  const containerRef = useRef<HTMLDivElement | null>(null);
  const currentYear = new Date().getFullYear();

  useEffect(() => {
    const ctx = gsap.context(() => {
      gsap.from(".card3d", { opacity: 0, y: 14, duration: 0.6, ease: "power2.out" });

      gsap.to(".card3d", {
        rotationY: 7,
        rotationX: -4,
        duration: 3,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true,
        transformOrigin: "50% 50%",
      });

      gsap.to(".tile3d", {
        y: -10,
        duration: 1.6,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true,
      });

      gsap.fromTo(
        ".halo",
        { scale: 0.95, opacity: 0.12 },
        { scale: 1.08, opacity: 0.24, duration: 1.5, ease: "sine.inOut", repeat: -1, yoyo: true }
      );

      gsap.fromTo(
        ".progress-fill",
        { scaleX: 0, transformOrigin: "0% 50%" },
        { scaleX: 1, duration: 1.6, ease: "power3.inOut", repeat: -1, yoyo: true }
      );

      gsap.utils.toArray<HTMLElement>(".progress-dot").forEach((dot) => {
        const dotWidth = dot.offsetWidth || 0;
        gsap.fromTo(
          dot,
          { x: 0, opacity: 0.2 },
          {
            x: `calc(100% - ${dotWidth}px)`,
            opacity: 1,
            duration: 1.6,
            ease: "power3.inOut",
            repeat: -1,
            yoyo: true,
          }
        );
      });

      gsap.from(".title, .subtitle, .foot", {
        y: 10,
        opacity: 0,
        duration: 0.6,
        ease: "power2.out",
        stagger: 0.08,
        delay: 0.1,
      });
    }, containerRef);

    return () => ctx.revert();
  }, []);

  return (
    <div
      ref={containerRef}
      className="fixed inset-0 z-[9999] flex items-center justify-center bg-gradient-to-br from-slate-50 via-slate-100 to-white text-slate-900"
      role="status"
      aria-live="polite"
    >
      <div className="relative w-full max-w-[440px] px-6" style={{ perspective: "1200px" }}>
        <div className="card3d relative w-full rounded-3xl bg-white/85 border border-slate-100 shadow-[0_20px_80px_-40px_rgba(0,0,0,0.35)] overflow-hidden">
          <div className="halo absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(59,130,246,0.12),transparent_45%),radial-gradient(circle_at_80%_40%,rgba(15,23,42,0.08),transparent_55%)]" />

          <div className="relative flex flex-col items-center gap-6 px-8 py-10">
            <div className="tile3d relative w-14 h-14 rounded-2xl bg-slate-900 text-white flex items-center justify-center shadow-[0_18px_40px_-22px_rgba(0,0,0,0.55)]">
              <Landmark className="w-8 h-8" />
            </div>

            <div className="text-center space-y-2">
              <div className="title text-2xl font-black tracking-tight uppercase">Primaria Almaj</div>
              <div className="subtitle text-xs font-semibold uppercase tracking-[0.28em] text-blue-700">Se încarca</div>
            </div>

            <div className="relative w-full max-w-[260px] h-2 rounded-full bg-slate-200 overflow-hidden">
              <div className="progress-fill absolute inset-y-0 left-0 bg-blue-600 rounded-full" />
              <div className="progress-dot absolute left-0 top-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-slate-900 shadow-[0_0_12px_-4px_rgba(0,0,0,0.4)]" />
            </div>

            <div className="foot text-[10px] uppercase tracking-[0.32em] font-black text-slate-400">
              Portal Digital • {currentYear}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default LoadingScreen;
